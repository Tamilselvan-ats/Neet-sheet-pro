<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEET ¬∑ personal prep</title>
  <!-- Font Awesome icons (free) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    body {
      background: #f4f7fc;
      color: #1e2b37;
      line-height: 1.5;
      padding-bottom: 2rem;
    }
    /* darkish mode friendly */
    .dark-theme {
      background: #121212;
      color: #e0e0e0;
    }
    /* navigation */
    .navbar {
      background: #0b2d3b;
      color: white;
      padding: 1rem 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .logo {
      font-weight: 600;
      font-size: 1.5rem;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .logo i {
      color: #6bc7d6;
    }
    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
    }
    .nav-links a {
      color: #f0f9ff;
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 0;
      border-bottom: 2px solid transparent;
      transition: 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .nav-links a:hover,
    .nav-links a.active {
      border-bottom-color: #6bc7d6;
      color: #ffffff;
    }
    .main-container {
      max-width: 1300px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }
    .page {
      display: none;
      animation: fade 0.25s ease;
    }
    .page.active {
      display: block;
    }
    @keyframes fade { from { opacity: 0.3; } to { opacity: 1; } }

    /* cards & layout */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    .card {
      background: white;
      border-radius: 24px;
      padding: 1.5rem;
      box-shadow: 0 6px 16px rgba(0,0,0,0.05);
      transition: 0.2s;
      border: 1px solid rgba(0,0,0,0.03);
    }
    .dark-theme .card {
      background: #1e2a32;
      border-color: #2a3a44;
    }
    .badge {
      background: #d0e9f0;
      color: #02576b;
      padding: 0.25rem 0.8rem;
      border-radius: 40px;
      font-size: 0.75rem;
      font-weight: 600;
      display: inline-block;
    }
    .btn {
      background: #0b2d3b;
      border: none;
      color: white;
      padding: 0.6rem 1.4rem;
      border-radius: 40px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      border: 1px solid transparent;
      transition: 0.2s;
    }
    .btn-outline {
      background: transparent;
      border-color: #0b2d3b;
      color: #0b2d3b;
    }
    .btn-outline i { color: #0b2d3b; }
    .btn:hover {
      background: #144e62;
    }
    .btn-outline:hover {
      background: #e3f0f5;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.7rem 1rem;
      border-radius: 40px;
      border: 1px solid #cbd5e1;
      background: white;
      font-size: 1rem;
    }
    .dark-theme input, .dark-theme select, .dark-theme textarea {
      background: #1e2a32;
      border-color: #3a4b57;
      color: #eee;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .progress-bar {
      height: 16px;
      background: #e2e8f0;
      border-radius: 40px;
      overflow: hidden;
      margin: 1rem 0;
    }
    .progress-fill {
      height: 100%;
      background: #1e8a9e;
      width: 0%;
    }
    .qa-block {
      margin-top: 1rem;
      border-top: 1px dashed #ccc;
      padding-top: 0.8rem;
    }
    .answer-toggle {
      background: none;
      border: none;
      color: #0b2d3b;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.3rem;
    }
    .answer-content {
      display: none;
      background: #f0f9fa;
      padding: 1rem;
      border-radius: 16px;
      margin-top: 0.8rem;
    }
    .dark-theme .answer-content {
      background: #2a3a44;
    }
    .answer-content.show {
      display: block;
    }
    .options-list {
      list-style: none;
      margin: 1rem 0;
    }
    .options-list li {
      background: #f5f9fc;
      margin: 0.5rem 0;
      padding: 0.6rem 1rem;
      border-radius: 40px;
    }
    .dark-theme .options-list li {
      background: #28353e;
    }
    .correct-option {
      background: #b8e0b8 !important;
      border-left: 6px solid #1b8c1b;
    }
    .delete-btn {
      color: #b91c1c;
      background: none;
      border: none;
      float: right;
      cursor: pointer;
      font-size: 1.2rem;
    }
    .footer-note {
      margin-top: 3rem;
      text-align: center;
      opacity: 0.7;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo"><i class="fas fa-brain"></i> NEET<span style="color:#6bc7d6;">.friend</span></div>
    <div class="nav-links" id="navLinks">
      <a href="#home" class="active" data-page="home"><i class="fas fa-home"></i> home</a>
      <a href="#pyqs" data-page="pyqs"><i class="fas fa-question-circle"></i> PYQs</a>
      <a href="#study" data-page="study"><i class="fas fa-book-open"></i> study</a>
      <a href="#alarm" data-page="alarm"><i class="fas fa-bell"></i> alarm</a>
      <a href="#mcq" data-page="mcq"><i class="fas fa-puzzle-piece"></i> MCQ gen</a>
    </div>
  </nav>

  <div class="main-container" id="mainContainer">
    <!-- HOME page -->
    <div id="home" class="page active">
      <h1><i class="fas fa-chart-line"></i> your neet cockpit</h1>
      <div class="card" style="max-width: 700px;">
        <h3>overall progress</h3>
        <div class="progress-bar" id="homeProgressBar"><div class="progress-fill" id="homeProgressFill" style="width:0%"></div></div>
        <p id="progressStats">0 / 0 questions reviewed</p>
      </div>
      <div class="card-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="card">
          <i class="fas fa-database" style="font-size: 2rem; color: #0b2d3b;"></i>
          <h3>pyq bank</h3>
          <p>previous year questions + your own collection. track what you've revised.</p>
          <button class="btn" data-page="pyqs"><i class="fas fa-arrow-right"></i> go to PYQs</button>
        </div>
        <div class="card">
          <i class="fas fa-flask" style="font-size: 2rem; color: #0b2d3b;"></i>
          <h3>mcq generator</h3>
          <p>smart quiz from pyq trends (simulated high‚Äëyield).</p>
          <button class="btn" data-page="mcq"><i class="fas fa-arrow-right"></i> try generator</button>
        </div>
      </div>
    </div>

    <!-- PYQs page -->
    <div id="pyqs" class="page">
      <h1><i class="fas fa-history"></i> previous year questions</h1>
      <div class="card">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
          <input type="text" id="pyqSearch" placeholder="üîç search topic / question" style="max-width: 300px;">
          <select id="topicFilter"><option value="all">all topics</option></select>
          <button class="btn" id="addPyqBtn"><i class="fas fa-plus"></i> add custom PYQ</button>
        </div>
      </div>
      <div id="pyqList" class="card-grid"></div>

      <!-- hidden form for adding pyq (simple toggle) -->
      <div id="addFormContainer" style="display: none; margin-top: 2rem;" class="card">
        <h3>‚ûï add new pyq</h3>
        <div class="form-group"><input type="text" id="newTopic" placeholder="topic (e.g. Biology)"></div>
        <div class="form-group"><input type="number" id="newYear" placeholder="year" value="2024"></div>
        <div class="form-group"><textarea id="newQuestion" placeholder="question text" rows="2"></textarea></div>
        <div class="form-group"><input type="text" id="newOpt0" placeholder="option A"></div>
        <div class="form-group"><input type="text" id="newOpt1" placeholder="option B"></div>
        <div class="form-group"><input type="text" id="newOpt2" placeholder="option C"></div>
        <div class="form-group"><input type="text" id="newOpt3" placeholder="option D"></div>
        <div class="form-group"><input type="number" id="newCorrect" placeholder="correct option index (0-3)" min="0" max="3" step="1"></div>
        <div class="form-group"><textarea id="newExplain" placeholder="explanation (optional)" rows="2"></textarea></div>
        <button class="btn" id="saveNewPyq"><i class="fas fa-save"></i> save question</button>
        <button class="btn-outline" id="cancelAddForm">cancel</button>
      </div>
    </div>

    <!-- STUDY page (open source links) -->
    <div id="study" class="page">
      <h1><i class="fas fa-graduation-cap"></i> open study material</h1>
      <div class="card-grid">
        <div class="card"><i class="fas fa-leaf"></i> <b>NCERT textbooks (PDF)</b><br> official biology, chem, physics. <a href="https://ncert.nic.in/textbook.php" target="_blank">ncert.nic.in ‚Üó</a></div>
        <div class="card"><i class="fas fa-flask"></i> <b>Khan Academy MCAT</b><br> high yield bio/chem <a href="https://www.khanacademy.org/test-prep/mcat" target="_blank">khanacademy.org ‚Üó</a></div>
        <div class="card"><i class="fas fa-dna"></i> <b>NEET prep (clc) </b><br> previous papers & notes <a href="https://www.nta.ac.in/neet" target="_blank">nta.ac.in ‚Üó</a></div>
        <div class="card"><i class="fas fa-atom"></i> <b>Physics libretexts</b><br> open access <a href="https://phys.libretexts.org/" target="_blank">libretexts.org ‚Üó</a></div>
      </div>
      <div class="card"><i class="fas fa-link"></i> <b>more open resources:</b> ‚Ä¢ e-PGPathshala (INFLIBNET) ‚Ä¢ cec.nic.in ‚Ä¢ nptel.ac.in (biology). All freely accessible.</div>
    </div>

    <!-- ALARM page with browser notifications -->
    <div id="alarm" class="page">
      <h1><i class="fas fa-clock"></i> daily reminder</h1>
      <div class="card" style="max-width: 500px;">
        <div class="form-group">
          <label>‚è∞ set alarm time (24h) :</label>
          <input type="time" id="alarmTimeInput" value="20:00">
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="alarmEnableCheck"> Enable notifications</label>
        </div>
        <button class="btn" id="saveAlarmBtn"><i class="fas fa-bell"></i> save alarm</button>
        <p id="alarmStatus" style="margin-top: 1rem;"></p>
      </div>
    </div>

    <!-- MCQ generator page -->
    <div id="mcq" class="page">
      <h1><i class="fas fa-random"></i> smart mcq generator</h1>
      <div class="card">
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
          <select id="mcqTopicFilter"><option value="all">all topics</option></select>
          <select id="mcqYearFilter"><option value="all">all years</option></select>
          <button class="btn" id="generateQuizBtn"><i class="fas fa-play"></i> generate quiz (5q)</button>
        </div>
      </div>
      <div id="quizContainer" style="display: none;" class="card">
        <h3 id="quizQuestionHeader"></h3>
        <div id="quizOptions"></div>
        <button class="btn" id="submitQuizAnswer" style="margin-right: 1rem;">submit</button>
        <button class="btn-outline" id="nextQuizQuestion" disabled>next</button>
        <div id="quizFeedback" style="margin-top: 1rem;"></div>
        <p id="quizScore">score: 0</p>
      </div>
    </div>
  </div>

  <div class="footer-note">
    <i class="fas fa-heart" style="color: #b22222;"></i> for friend ¬∑ data stored locally
  </div>

  <script>
    (function() {
      // ---------- PRELOADED PYQs (open source style) ----------
      const PRELOADED = [
        { id: 'p0', topic: 'Biology', year: 2023, question: 'Which organelle is known as the powerhouse of the cell?', options: ['Nucleus', 'Mitochondria', 'Ribosome', 'Golgi body'], answer: 1, explanation: 'Mitochondria produce ATP.' },
        { id: 'p1', topic: 'Chemistry', year: 2022, question: 'Which gas is evolved when sodium reacts with ethanol?', options: ['Oxygen', 'Hydrogen', 'Carbon dioxide', 'Nitrogen'], answer: 1, explanation: 'Sodium ethoxide and hydrogen gas.' },
        { id: 'p2', topic: 'Physics', year: 2021, question: 'SI unit of electric current is', options: ['Volt', 'Ampere', 'Ohm', 'Coulomb'], answer: 1, explanation: 'Ampere (A).' },
        { id: 'p3', topic: 'Biology', year: 2020, question: 'Blood group lacking antigens is', options: ['A', 'B', 'AB', 'O'], answer: 3, explanation: 'O type has no A or B antigens.' },
        { id: 'p4', topic: 'Chemistry', year: 2023, question: 'Which element is present in all organic compounds?', options: ['Carbon', 'Oxygen', 'Nitrogen', 'Hydrogen'], answer: 0, explanation: 'Carbon backbone.' },
        { id: 'p5', topic: 'Physics', year: 2022, question: 'The device used to measure potential difference', options: ['Ammeter', 'Voltmeter', 'Galvanometer', 'Wheatstone bridge'], answer: 1, explanation: 'Voltmeter is connected in parallel.' },
      ];

      // ---------- global state ----------
      let customQuestions = JSON.parse(localStorage.getItem('neet_custom_pyqs')) || [];
      let completedQuestions = JSON.parse(localStorage.getItem('neet_completed')) || [];
      let alarmTime = localStorage.getItem('neet_alarm_time') || '20:00';
      let alarmEnabled = localStorage.getItem('neet_alarm_enabled') === 'true' ? true : false;

      // combined list (preloaded + custom)
      function getAllQuestions() {
        return [...PRELOADED, ...customQuestions];
      }

      // save helpers
      function saveCustom() {
        localStorage.setItem('neet_custom_pyqs', JSON.stringify(customQuestions));
      }
      function saveCompleted() {
        localStorage.setItem('neet_completed', JSON.stringify(completedQuestions));
      }
      function saveAlarmPrefs() {
        localStorage.setItem('neet_alarm_time', alarmTime);
        localStorage.setItem('neet_alarm_enabled', alarmEnabled);
      }

      // ----- progress calculations -----
      function updateProgressDisplay() {
        const all = getAllQuestions();
        const total = all.length;
        const done = all.filter(q => completedQuestions.includes(q.id)).length;
        const percent = total ? (done / total * 100) : 0;
        document.getElementById('homeProgressFill').style.width = percent + '%';
        document.getElementById('progressStats').innerText = `${done} / ${total} questions reviewed`;
        // also update progress bar on pyq page? maybe later
      }

      // ----- render PYQ list (with filters) -----
      function renderPYQs() {
        const searchTerm = document.getElementById('pyqSearch')?.value.toLowerCase() || '';
        const topicFilter = document.getElementById('topicFilter')?.value || 'all';
        const container = document.getElementById('pyqList');
        if (!container) return;
        let all = getAllQuestions();

        // populate topic filter if needed (dynamic)
        const topics = [...new Set(all.map(q => q.topic))];
        const filterSelect = document.getElementById('topicFilter');
        if (filterSelect) {
          const currentVal = filterSelect.value;
          filterSelect.innerHTML = '<option value="all">all topics</option>' + topics.map(t => `<option value="${t}">${t}</option>`).join('');
          if (topics.includes(currentVal)) filterSelect.value = currentVal;
          else filterSelect.value = 'all';
        }

        // filter
        let filtered = all.filter(q => {
          if (topicFilter !== 'all' && q.topic !== topicFilter) return false;
          if (searchTerm && !q.question.toLowerCase().includes(searchTerm) && !q.topic.toLowerCase().includes(searchTerm)) return false;
          return true;
        });

        if (filtered.length === 0) {
          container.innerHTML = '<div class="card">no questions match üßê</div>';
          return;
        }

        container.innerHTML = filtered.map(q => {
          const isCompleted = completedQuestions.includes(q.id);
          const isCustom = q.id.startsWith('q'); // custom ids start with q
          return `
            <div class="card" style="position: relative;" data-id="${q.id}">
              ${isCustom ? '<button class="delete-btn" data-id="${q.id}" onclick="deleteCustomPyq(\''+q.id+'\')"><i class="fas fa-trash"></i></button>' : ''}
              <div><span class="badge">${q.topic} ${q.year}</span> ${isCompleted ? '<span class="badge" style="background:#c8e6c9;">‚úÖ done</span>' : ''}</div>
              <p style="margin: 0.8rem 0;"><strong>Q:</strong> ${q.question}</p>
              <div class="options-list">${q.options.map((opt,i)=> `<li class="${q.answer === i ? 'correct-option' : ''}">${String.fromCharCode(65+i)}. ${opt}</li>`).join('')}</div>
              <button class="answer-toggle" onclick="toggleAnswer('${q.id}')"><i class="fas fa-eye"></i> show answer</button>
              <div class="answer-content" id="ans-${q.id}"><b>‚úÖ correct:</b> ${q.options[q.answer]} <br><i>${q.explanation || 'no explanation'}</i></div>
              <div style="margin-top: 0.8rem;">
                <button class="btn-outline" onclick="markComplete('${q.id}')">${isCompleted ? '‚úîÔ∏è completed' : '‚¨ú mark reviewed'}</button>
              </div>
            </div>
          `;
        }).join('');
      }

      // global functions for onclick
      window.toggleAnswer = function(id) {
        const el = document.getElementById('ans-'+id);
        if (el) el.classList.toggle('show');
      };
      window.markComplete = function(id) {
        if (completedQuestions.includes(id)) {
          completedQuestions = completedQuestions.filter(c => c !== id);
        } else {
          completedQuestions.push(id);
        }
        saveCompleted();
        updateProgressDisplay();
        renderPYQs();  // refresh checkmark
      };
      window.deleteCustomPyq = function(id) {
        customQuestions = customQuestions.filter(q => q.id !== id);
        saveCustom();
        // also remove from completed
        completedQuestions = completedQuestions.filter(c => c !== id);
        saveCompleted();
        renderPYQs();
        updateProgressDisplay();
      };

      // ----- add custom PYQ -----
      document.addEventListener('click', function(e) {
        if (e.target.closest('#addPyqBtn')) {
          document.getElementById('addFormContainer').style.display = 'block';
        }
        if (e.target.closest('#cancelAddForm')) {
          document.getElementById('addFormContainer').style.display = 'none';
        }
        if (e.target.closest('#saveNewPyq')) {
          const topic = document.getElementById('newTopic').value.trim();
          const year = parseInt(document.getElementById('newYear').value) || 2024;
          const question = document.getElementById('newQuestion').value.trim();
          const opt0 = document.getElementById('newOpt0').value.trim();
          const opt1 = document.getElementById('newOpt1').value.trim();
          const opt2 = document.getElementById('newOpt2').value.trim();
          const opt3 = document.getElementById('newOpt3').value.trim();
          const correctIdx = parseInt(document.getElementById('newCorrect').value);
          const expl = document.getElementById('newExplain').value.trim();
          if (!topic || !question || !opt0 || !opt1 || !opt2 || !opt3 || isNaN(correctIdx) || correctIdx<0 || correctIdx>3) {
            alert('please fill all options and valid correct index (0-3)');
            return;
          }
          const newId = 'q' + Date.now() + Math.floor(Math.random()*1000);
          customQuestions.push({
            id: newId,
            topic, year, question,
            options: [opt0, opt1, opt2, opt3],
            answer: correctIdx,
            explanation: expl || 'user contributed'
          });
          saveCustom();
          document.getElementById('addFormContainer').style.display = 'none';
          // clear form
          ['newTopic','newQuestion','newOpt0','newOpt1','newOpt2','newOpt3','newExplain'].forEach(id => document.getElementById(id).value = '');
          document.getElementById('newYear').value = 2024;
          document.getElementById('newCorrect').value = '';
          renderPYQs();
          updateProgressDisplay();
        }
      });

      // ----- navigation -----
      const pages = document.querySelectorAll('.page');
      const navLinks = document.querySelectorAll('.nav-links a');
      function showPage(pageId) {
        pages.forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        navLinks.forEach(a => {
          a.classList.remove('active');
          if (a.dataset.page === pageId) a.classList.add('active');
        });
        if (pageId === 'pyqs') renderPYQs();
        if (pageId === 'mcq') populateMcqFilters();
        if (pageId === 'alarm') {
          document.getElementById('alarmTimeInput').value = alarmTime;
          document.getElementById('alarmEnableCheck').checked = alarmEnabled;
          updateAlarmStatus();
        }
      }
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const page = link.dataset.page;
          showPage(page);
          history.pushState(null, '', '#'+page);
        });
      });
      // hash change
      window.addEventListener('hashchange', () => {
        const hash = location.hash.slice(1) || 'home';
        if (['home','pyqs','study','alarm','mcq'].includes(hash)) showPage(hash);
      });
      if (location.hash) {
        const hash = location.hash.slice(1);
        if (['home','pyqs','study','alarm','mcq'].includes(hash)) showPage(hash);
      }

      // ----- alarm & notification -----
      function requestNotificationPermission() {
        if (!("Notification" in window)) { alert("Browser doesn't support notifications"); return false; }
        if (Notification.permission === "granted") return true;
        if (Notification.permission !== "denied") {
          Notification.requestPermission().then(perm => {
            if (perm === "granted") updateAlarmStatus();
          });
        }
        return false;
      }

      function updateAlarmStatus() {
        const status = document.getElementById('alarmStatus');
        if (!status) return;
        if (!alarmEnabled) status.innerText = '‚è∏Ô∏è alarm disabled';
        else if (Notification.permission !== "granted") status.innerText = 'üîï notification permission missing';
        else status.innerText = `‚è∞ daily alarm set for ${alarmTime}`;
      }

      document.getElementById('saveAlarmBtn')?.addEventListener('click', () => {
        const time = document.getElementById('alarmTimeInput').value;
        const enabled = document.getElementById('alarmEnableCheck').checked;
        if (enabled && (!time)) { alert('select time'); return; }
        alarmTime = time;
        alarmEnabled = enabled;
        saveAlarmPrefs();
        if (enabled && Notification.permission !== "granted") requestNotificationPermission();
        updateAlarmStatus();
        alert('alarm saved! (keep page open for notifications)');
      });

      // alarm checker every 60 seconds
      setInterval(() => {
        if (!alarmEnabled) return;
        if (Notification.permission !== "granted") return;
        const now = new Date();
        const currentHH = String(now.getHours()).padStart(2,'0');
        const currentMM = String(now.getMinutes()).padStart(2,'0');
        const currentTime = `${currentHH}:${currentMM}`;
        if (currentTime === alarmTime) {
          new Notification("‚è∞ NEET prep reminder", { body: "Time to study! check your PYQs.", icon: "üîî" });
        }
      }, 60000);

      // ----- MCQ generator logic -----
      let currentQuiz = []; // array of question objects
      let quizIndex = 0;
      let quizScore = 0;
      let answeredCurrent = false;

      function populateMcqFilters() {
        const all = getAllQuestions();
        const topics = [...new Set(all.map(q => q.topic))];
        const years = [...new Set(all.map(q => q.year))].sort((a,b)=>b-a);
        const topicSelect = document.getElementById('mcqTopicFilter');
        const yearSelect = document.getElementById('mcqYearFilter');
        if (topicSelect) {
          topicSelect.innerHTML = '<option value="all">all topics</option>' + topics.map(t => `<option value="${t}">${t}</option>`).join('');
        }
        if (yearSelect) {
          yearSelect.innerHTML = '<option value="all">all years</option>' + years.map(y => `<option value="${y}">${y}</option>`).join('');
        }
      }

      document.getElementById('generateQuizBtn')?.addEventListener('click', ()=>{
        const topic = document.getElementById('mcqTopicFilter').value;
        const year = document.getElementById('mcqYearFilter').value;
        let all = getAllQuestions();
        let filtered = all.filter(q => (topic === 'all' || q.topic === topic) && (year === 'all' || q.year == year));
        if (filtered.length < 1) { alert('no questions with those filters'); return; }
        // random 5 or less
        const shuffled = filtered.sort(()=>0.5-Math.random());
        currentQuiz = shuffled.slice(0,5);
        quizIndex = 0;
        quizScore = 0;
        answeredCurrent = false;
        document.getElementById('quizContainer').style.display = 'block';
        document.getElementById('nextQuizQuestion').disabled = true;
        renderQuizQuestion();
      });

      function renderQuizQuestion() {
        if (!currentQuiz.length || quizIndex >= currentQuiz.length) {
          document.getElementById('quizContainer').style.display = 'none';
          alert(`quiz finished! score: ${quizScore}/${currentQuiz.length}`);
          return;
        }
        const q = currentQuiz[quizIndex];
        document.getElementById('quizQuestionHeader').innerText = `Q${quizIndex+1}: ${q.question}`;
        let optsHtml = '';
        q.options.forEach((opt, idx) => {
          optsHtml += `<div style="margin:0.5rem 0;"><label><input type="radio" name="quizOpt" value="${idx}" ${answeredCurrent ? 'disabled' : ''}> ${String.fromCharCode(65+idx)}. ${opt}</label></div>`;
        });
        document.getElementById('quizOptions').innerHTML = optsHtml;
        document.getElementById('quizFeedback').innerHTML = '';
        document.getElementById('quizScore').innerText = `score: ${quizScore}`;
        if (answeredCurrent) {
          document.getElementById('submitQuizAnswer').disabled = true;
          document.getElementById('nextQuizQuestion').disabled = false;
        } else {
          document.getElementById('submitQuizAnswer').disabled = false;
          document.getElementById('nextQuizQuestion').disabled = true;
        }
      }

      document.getElementById('submitQuizAnswer')?.addEventListener('click', ()=>{
        if (answeredCurrent) return;
        const selected = document.querySelector('input[name="quizOpt"]:checked');
        if (!selected) { alert('pick an option'); return; }
        const ans = parseInt(selected.value);
        const q = currentQuiz[quizIndex];
        const isCorrect = (ans === q.answer);
        if (isCorrect) quizScore++;
        answeredCurrent = true;
        const feedback = isCorrect ? '‚úÖ correct!' : `‚ùå wrong. correct: ${q.options[q.answer]}`;
        document.getElementById('quizFeedback').innerHTML = `<div class="card" style="background:#f0f9f0;">${feedback}<br><i>${q.explanation || ''}</i></div>`;
        document.getElementById('submitQuizAnswer').disabled = true;
        document.getElementById('nextQuizQuestion').disabled = false;
        document.getElementById('quizScore').innerText = `score: ${quizScore}`;
      });

      document.getElementById('nextQuizQuestion')?.addEventListener('click', ()=>{
        quizIndex++;
        answeredCurrent = false;
        if (quizIndex < currentQuiz.length) renderQuizQuestion();
        else {
          // end
          document.getElementById('quizContainer').style.display = 'none';
          alert(`üèÅ quiz done! final score: ${quizScore}/${currentQuiz.length}`);
        }
      });

      // ---- init ----
      updateProgressDisplay();
      renderPYQs();
      populateMcqFilters();
      updateAlarmStatus();
      // if notification already granted, fine
      if (alarmEnabled && Notification.permission === "default") requestNotificationPermission();
    })();
  </script>
  <!-- ensure delete works from innerHTML (global accessible) -->
  <script>
    // re-declare for safety (deleteCustomPyq already global via window)
    window.deleteCustomPyq = function(id) {
      // the function is inside closure, but we override to be safe
      location.reload(); // quick fallback: but actual defined above, this is just placeholder.
    };
  </script>
</body>
</html>